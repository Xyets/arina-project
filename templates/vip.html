<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>VIP‚Äë–ª–∏—Å—Ç</title>
  <link rel="icon" href="{{ url_for('static', filename='icon.png') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #fdfbfb, #ebedee);
      margin: 0;
      padding: 40px;
      color: #333;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
    }

    header img {
      height: 60px;
    }

    header h1 {
      font-size: 28px;
      font-weight: 600;
      margin: 0;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }

    .search-bar input {
      padding: 10px 15px;
      border-radius: 20px;
      border: 1px solid #ccc;
      width: 250px;
      font-size: 16px;
    }

    .search-bar button {
      padding: 10px 20px;
      border-radius: 20px;
      border: none;
      background: #a3d8f4;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .vip-card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      position: relative;
    }

    .vip-card.blocked {
      background: #ffe0e0;
    }

    .vip-card h3 {
      margin: 0 0 10px;
      font-size: 20px;
      color: #444;
    }

    .vip-card input[type="text"] {
      width: 100%;
      padding: 6px;
      margin-bottom: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-family: monospace;
    }

    .vip-card .meta {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
    }

    .vip-card .actions {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .vip-card button {
      background: #f7a8b8;
      border: none;
      padding: 6px 12px;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }

    .vip-card button:hover {
      background: #f28497;
    }

    .sort-links a {
      margin-right: 10px;
      font-size: 14px;
      color: #888;
      text-decoration: none;
    }

    .sort-links a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <img src="{{ url_for('static', filename='icon.png') }}" alt="Logo">
    <h1>VIP‚Äë–ª–∏—Å—Ç –¥–ª—è {{ user }}</h1>
  </header>

  <div class="top-bar">
    <form method="GET" action="/vip" class="search-bar">
      <input type="text" name="q" placeholder="üîç –ü–æ–∏—Å–∫..." value="{{ query }}">
      <button type="submit">–ù–∞–π—Ç–∏</button>
      {% if query %}<a href="/vip">–°–±—Ä–æ—Å–∏—Ç—å</a>{% endif %}
    </form>

    <div class="sort-links">
      <a href="/vip?sort=total">üíó –ü–æ —á–∞–µ–≤—ã–º</a>
      <a href="/vip?sort=login_count">üìÖ –ü–æ –≤–∏–∑–∏—Ç–∞–º</a>
    </div>

    <form method="POST" action="/clear_vip">
      <button>üßπ –û—á–∏—Å—Ç–∏—Ç—å VIP‚Äë–ª–∏—Å—Ç</button>
    </form>
  </div>

  <div class="card-grid">
    {% for user_id, info in members %}
    <div class="vip-card {% if info.blocked %}blocked{% endif %}" id="card_{{ user_id }}">
      <form method="POST">
        <input type="hidden" name="user_id" value="{{ user_id }}">
        <h3><input type="text" name="name" value="{{ info.name }}"></h3>
        <input type="text" name="notes" value="{{ info.notes }}" placeholder="–ó–∞–º–µ—Ç–∫–∏">
        <div class="meta">
          üíó {{ info.total }} | üìÖ {{ info.login_count }} –≤—Ö–æ–¥–æ–≤<br>
          üïí –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–∑–∏—Ç: <span class="date">{{ info._previous_login or info.last_login }}</span>
          üÜî ID: {{ user_id }}
        </div>
        <div class="actions">
          <button type="submit">üíæ</button>
          <button type="button" onclick="removeMember('{{ user_id }}')">üóëÔ∏è</button>
          <form method="POST" action="/block_member" class="inline">
            <input type="hidden" name="user_id" value="{{ user_id }}">
            <button>üö´</button>
          </form>
        </div>
      </form>
    </div>
    {% endfor %}
  </div>

  <script>
    function removeMember(userId) {
      fetch("/remove_member", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "user_id=" + encodeURIComponent(userId)
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === "ok") {
          document.getElementById("card_" + userId)?.remove();
        } else {
          alert("‚ùå " + data.message);
        }
      })
      .catch(() => alert("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è"));
    }

    // —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
    document.querySelectorAll(".date").forEach(el => {
      const raw = el.textContent;
      if (!raw) return;
      const d = new Date(raw);
      el.textContent = d.toLocaleString("ru-RU", {
        day: "numeric",
        month: "long",
        hour: "2-digit",
        minute: "2-digit"
      });
    });
  </script>
</body>
</html>
