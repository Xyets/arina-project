<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>OBS Alert</title>
  <style>
    body {
      margin:0; background:transparent; overflow:hidden;
      font-family: 'Poppins', sans-serif; color: white; text-align: center;
    }

    .alert {
      position:absolute; top:10%; left:50%; transform:translateX(-50%);
      background:rgba(0,0,0,0.7); border-radius:20px; padding:10px 20px;
      font-size:20px; color:#fff; text-shadow:2px 2px 5px #000;
      opacity:0; transition:opacity 0.5s;
    }
    .alert.show { opacity:1; animation: fadeOut 6s forwards; }
    @keyframes fadeOut { 0%{opacity:1;} 100%{opacity:0;} }

    .gif-container { display:inline-block; position:relative; margin-top:80px; }

    .vibration-gif {
      width:200px; height:auto;
      transition: transform 0.3s ease, filter 0.3s ease;
    }

    @keyframes pulse {
      0%   { transform: scale(1); }
      25%  { transform: scale(1.2); }
      50%  { transform: scale(0.9); }
      75%  { transform: scale(1.15); }
      100% { transform: scale(1); }
    }

    .value { font-size:20px; margin-top:10px; }
  </style>
</head>
<body>
  <div class="alert" id="alertBox">
    ðŸŽ‰ <span id="eventType"></span><br>
    ðŸ‘¤ <span id="donator"></span> | ðŸ’° <span id="amount"></span>
  </div>

  <div class="gif-container">
    <img src="vibration.gif" class="vibration-gif" id="vibrationGif" />
    <div class="value" id="value">Ð¡Ð¸Ð»Ð°: 10</div>
  </div>

  <script>
    function updateVibration(strength) {
      const gif = document.getElementById("vibrationGif");
      const value = document.getElementById("value");

      if (isNaN(strength) || strength < 1) strength = 1;
      if (strength > 20) strength = 20;

      value.textContent = "Ð¡Ð¸Ð»Ð°: " + strength;

      const amplitude = 1 + strength / 20;
      const cycles = Math.ceil(strength / 5);
      const glowSize = strength * 2;
      const glowOpacity = 0.3 + strength / 30;

      gif.style.animation = `pulse 1s ease-in-out ${cycles}`;
      gif.style.transform = `scale(${amplitude})`;
      gif.style.filter = `drop-shadow(0 0 ${glowSize}px rgba(255,105,180,${glowOpacity}))`;

      setTimeout(() => {
        gif.style.animation = "";
        gif.style.transform = "scale(1)";
        gif.style.filter = "drop-shadow(0 0 10px rgba(255,105,180,0.5))";
      }, cycles * 1000);
    }

    function showAlert(type, donator, amount) {
      const alertBox = document.getElementById("alertBox");
      document.getElementById("eventType").textContent = type || "Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ";
      document.getElementById("donator").textContent = donator || "ÐÐ½Ð¾Ð½Ð¸Ð¼";
      document.getElementById("amount").textContent = amount || "â€”";
      alertBox.classList.add("show");
      setTimeout(() => alertBox.classList.remove("show"), 6000);
    }

    // WebSocket
    let socket;
    function connectWS() {
      const wsUrl = "wss://arinairina.duckdns.org/ws/"; // ÑƒÐºÐ°Ð¶Ð¸ ÑÐ²Ð¾Ð¹ ÑÐµÑ€Ð²ÐµÑ€
      socket = new WebSocket(wsUrl);

      socket.onmessage = (event) => {
        let data;
        try { data = JSON.parse(event.data); } catch { return; }

        if (data.vibration) {
          const { strength, duration, donor, amount } = data.vibration;

          // Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð²Ð¸Ð±Ñ€Ð°Ñ†Ð¸ÑŽ
          updateVibration(strength);

          // Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð°Ð»ÐµÑ€Ñ‚
          showAlert("Ð’Ð¸Ð±Ñ€Ð°Ñ†Ð¸Ñ", donor, amount);

          // ÑÐ±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· duration ÑÐµÐºÑƒÐ½Ð´
          setTimeout(() => updateVibration(0), duration * 1000);
        }
      };
    }

    connectWS();
  </script>
</body>
</html>
