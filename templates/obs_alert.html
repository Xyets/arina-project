<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>OBS Alert</title>
  <!-- Animate.css –¥–ª—è –≥–æ—Ç–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <!-- GSAP –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <style>
    body { margin:0; background:transparent; overflow:hidden; font-family: 'Poppins', sans-serif; }
    .alert {
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      background:rgba(0,0,0,0.7); border-radius:20px; padding:20px 40px;
      font-size:28px; color:#fff; text-shadow:2px 2px 5px #000;
      opacity:0;
    }
    .alert.show { opacity:1; }

    .particle {
      position: fixed;
      font-size: 24px;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="alert animate__animated" id="alertBox">
    üéâ <span id="eventType"></span><br>
    üë§ <span id="donator"></span> | üí∞ <span id="amount"></span>
  </div>

  <script>
    let socket;

    function connectWS() {
      socket = new WebSocket("wss://arinairina.duckdns.org/ws/");

      socket.onopen = () => console.log("‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á—ë–Ω");
      socket.onclose = () => setTimeout(connectWS, 2000);

      socket.onmessage = (event) => {
        let data;
        try { data = JSON.parse(event.data); } catch { return; }

        const box = document.getElementById("alertBox");

        // --- –î–æ–Ω–∞—Ç ---
        if (data.vibration) {
          const { strength, duration, target } = data.vibration;
          document.getElementById("eventType").textContent = "–î–æ–Ω–∞—Ç";
          document.getElementById("donator").textContent = target;
          document.getElementById("amount").textContent =
            `—Å–∏–ª–∞=${strength}, –≤—Ä–µ–º—è=${duration}s`;

          // –ü–æ—è–≤–ª–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞ —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º
          box.classList.add("show","animate__bounceIn");
          setTimeout(()=>box.classList.remove("animate__bounceIn"),1000);
          setTimeout(()=>box.classList.add("animate__fadeOut"),duration*1000);

          // –ê–Ω–∏–º–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–ª—ã
          if (strength === 1) {
            // üíñ —Å–µ—Ä–¥–µ—á–∫–∏ —Å GSAP
            for (let i=0; i<15; i++) {
              const heart = document.createElement("div");
              heart.className = "particle";
              heart.textContent = "üíñ";
              heart.style.left = Math.random()*100 + "vw";
              heart.style.top = "100vh";
              document.body.appendChild(heart);
              gsap.to(heart, {
                y: -window.innerHeight,
                duration: 3+Math.random()*2,
                opacity: 0,
                onComplete: ()=>heart.remove()
              });
            }
          } else {
            // üéâ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ —Å GSAP
            for (let i=0; i<25; i++) {
              const conf = document.createElement("div");
              conf.className = "particle";
              conf.textContent = "üéâ";
              conf.style.left = Math.random()*100 + "vw";
              conf.style.top = "-50px";
              document.body.appendChild(conf);
              gsap.to(conf, {
                y: window.innerHeight+100,
                x: "+="+(Math.random()*200-100),
                rotation: 360,
                duration: 3+Math.random()*2,
                opacity: 0,
                onComplete: ()=>conf.remove()
              });
            }
          }
        }
      };
    }

    connectWS();
  </script>
</body>
</html>
