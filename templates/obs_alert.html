<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>OBS Alert</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <style>
    body { margin:0; background:transparent; overflow:hidden; font-family: 'Poppins', sans-serif; }

    .alert {
      position:absolute; top:10%; left:50%; transform:translateX(-50%);
      background:rgba(0,0,0,0.7); border-radius:20px; padding:10px 20px;
      font-size:20px; color:#fff; text-shadow:2px 2px 5px #000;
      opacity:0; transition:opacity 0.5s;
    }
    .alert.show { opacity:1; animation: fadeOut 6s forwards; }
    @keyframes fadeOut { 0%{opacity:1;} 100%{opacity:0;} }

    /* –®–∫–∞–ª–∞ */
    .tank {
      position:absolute;
      bottom:10%; left:50%; transform:translateX(-50%);
      width: 80px; height: 250px;
      border: 4px solid #fff;
      border-radius: 20px;
      background: rgba(255,255,255,0.1);
      overflow: hidden;
      box-shadow: 0 0 20px rgba(255,105,180,0.6);
    }

    .liquid {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 0%;
      background: linear-gradient(to top, #ff69b4, #ffc0cb);
      box-shadow: 0 0 30px #ff69b4;
      transition: height 0.5s ease;
    }

    .wave {
      position: absolute;
      bottom: 0;
      width: 200%;
      height: 40px;
      background: rgba(255,182,193,0.7);
      border-radius: 50%;
      animation: waveMove 4s linear infinite;
    }
    @keyframes waveMove {
      from { transform: translateX(0); }
      to   { transform: translateX(-50%); }
    }

    .bubble {
      position: absolute;
      bottom: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.8);
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <div class="alert" id="alertBox">
    üéâ <span id="eventType"></span><br>
    üë§ <span id="donator"></span> | üí∞ <span id="amount"></span>
  </div>

  <div class="tank">
    <div class="liquid" id="liquid">
      <div class="wave"></div>
    </div>
  </div>

  <script>
    // —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —à–∫–∞–ª—ã
    function setStrength(value) {
      const liquid = document.getElementById("liquid");
      liquid.style.height = value + "%";

      // –ø—É–∑—ã—Ä—å–∫–∏
      for (let i=0; i<3; i++) {
        const bubble = document.createElement("div");
        bubble.className = "bubble";
        const size = 5 + Math.random()*10;
        bubble.style.width = size+"px";
        bubble.style.height = size+"px";
        bubble.style.left = Math.random()*70 + "px";
        bubble.style.bottom = "0";
        liquid.appendChild(bubble);

        gsap.to(bubble, {
          y: -250,
          x: "+="+(Math.random()*40-20),
          opacity: 0,
          duration: 2+Math.random()*2,
          onComplete: ()=>bubble.remove()
        });
      }
    }

    let socket;
    function connectWS() {
      socket = new WebSocket("wss://arinairina.duckdns.org/ws/");

      socket.onopen = () => {
        console.log("‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á—ë–Ω");
        if (socket._pingInterval) clearInterval(socket._pingInterval);
        socket._pingInterval = setInterval(() => {
          if (socket.readyState === WebSocket.OPEN) {
            socket.send(JSON.stringify({ type: "ping" }));
          }
        }, 30000);
      };

      socket.onclose = () => {
        console.log("‚ùå WebSocket –∑–∞–∫—Ä—ã—Ç, –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...");
        if (socket._pingInterval) clearInterval(socket._pingInterval);
        setTimeout(connectWS, 2000);
      };

      socket.onmessage = (event) => {
        let data;
        try { data = JSON.parse(event.data); } catch { return; }

        if (data.vibration) {
          const { strength, duration, target } = data.vibration;
          document.getElementById("eventType").textContent = "–î–æ–Ω–∞—Ç";
          document.getElementById("donator").textContent = target;
          document.getElementById("amount").textContent =
            `—Å–∏–ª–∞=${strength}, –≤—Ä–µ–º—è=${duration}s`;

          // –æ–±–Ω–æ–≤–ª—è–µ–º —à–∫–∞–ª—É (0‚Äì10 ‚Üí 0‚Äì100%)
          setStrength(strength * 10);
        }

        if (data.entry) {
          document.getElementById("eventType").textContent = "–í—Ö–æ–¥ VIP";
          document.getElementById("donator").textContent = data.entry.name;
          document.getElementById("amount").textContent =
            `–í—Ö–æ–¥–æ–≤: ${data.entry.visits}, –î–æ–Ω–∞—Ç–æ–≤: ${data.entry.total_tips}`;
        }

        if (data.vip_update) {
          document.getElementById("eventType").textContent = "VIP –æ–±–Ω–æ–≤–ª—ë–Ω";
          document.getElementById("donator").textContent = data.user_id || "";
          document.getElementById("amount").textContent = "";
        }

        const box = document.getElementById("alertBox");
        box.classList.add("show");
        setTimeout(()=>box.classList.remove("show"), 6000);
      };
    }

    connectWS();
  </script>
</body>
</html>
