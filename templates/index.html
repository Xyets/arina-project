<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
</head>
<body>
    <h1>üëã –ü—Ä–∏–≤–µ—Ç, {{ user }}</h1>

    <p>üîó –ê–¥—Ä–µ—Å WebSocket –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: 
        <code>wss://arinairina.duckdns.org/ws/</code>
    </p>

    <p><a href="{{ url_for('qrcode_page') }}">üì± –ü–æ–ª—É—á–∏—Ç—å QR‚Äë–∫–æ–¥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</a></p>
    <p><a href="{{ url_for('rules') }}">üìú –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏</a></p>

    <h3>üìú –õ–æ–≥–∏ –¥–æ–Ω–∞—Ç–æ–≤</h3>
    <div id="logbox" style="border:1px solid #ccc; padding:10px; height:300px; overflow-y:scroll; background:#fff; color:#000; font-family:monospace;"></div>
    <form method="POST" action="/clear_logs">
        <button type="submit">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </form>

    <h3>üîÅ –û—á–µ—Ä–µ–¥—å –≤–∏–±—Ä–∞—Ü–∏–π</h3>
    <div id="queuebox" style="border:1px solid #ccc; padding:10px; height:200px; overflow-y:scroll; background:#f9f9f9; color:#000; font-family:monospace;"></div>

    <script>
        async function loadLogs() {
            const res = await fetch("/logs_data");
            const data = await res.json();
            const box = document.getElementById("logbox");
            box.innerHTML = data.logs.map(l => {
                if (l.includes("üé¨")) {
                    return `<div style="color: goldenrod; font-weight: bold;">${l}</div>`;
                }
                return `<div>${l}</div>`;
            }).join("");
            box.scrollTop = box.scrollHeight;
        }

        async function loadQueue() {
            const res = await fetch("/queue_data");
            const data = await res.json();
            const box = document.getElementById("queuebox");
            if (data.queue.length === 0) {
                box.innerHTML = "<div>–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞ ‚úÖ</div>";
            } else {
                box.innerHTML = data.queue.map(([strength, duration], i) => {
                    return `<div>#${i + 1} ‚Üí —Å–∏–ª–∞: ${strength}, –≤—Ä–µ–º—è: ${duration}s</div>`;
                }).join("");
            }
        }

        setInterval(loadLogs, 2000);
        setInterval(loadQueue, 2000);
        loadLogs();
        loadQueue();
    </script>

    <p><a href="{{ url_for('logout') }}">üö™ –í—ã–π—Ç–∏</a></p>
</body>
</html>
