<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>OBS Ð ÐµÐ°ÐºÑ†Ð¸Ð¸</title>
  <style>
    body {
      margin: 0;
      background: transparent; /* Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ„Ð¾Ð½ Ð±Ñ‹Ð» Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¼ Ð² OBS */
      overflow: hidden;
    }
    #reaction {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none;
      animation: fadeIn 0.5s, fadeOut 0.5s forwards;
    }
    #reaction img {
      max-width: 80%;
      max-height: 80%;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="reaction"></div>

  <script>
    const profileKey = "{{ profile_key }}"; // Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‘Ñ‚ÑÑ Ð¸Ð· Flask
    const ws = new WebSocket("wss://arinairina.duckdns.org/ws/");

    ws.onopen = () => {
        console.log("ðŸ”Œ WebSocket Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ñ‘Ð½");
        ws.send(JSON.stringify({
            type: "hello",
            role: "obs",
            profile_key: profileKey
        }));
    };

    ws.onerror = (err) => {
    console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° WebSocket:", err);
    };

    ws.onclose = () => {
    console.warn("âš ï¸ WebSocket Ð·Ð°ÐºÑ€Ñ‹Ñ‚");
    };

    ws.onmessage = (event) => {
    try {
        const data = JSON.parse(event.data);
        console.log("ðŸ“© WS raw:", data);

        if (data.reaction && data.profile === profileKey) {
        showReaction(data.image, data.duration || 5);
        }
    } catch (e) {
        console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ WS:", e);
    }
    };


    function showReaction(imagePath, duration) {
      const container = document.getElementById("reaction");
      container.innerHTML = `<img src="/static/${imagePath}" alt="reaction">`;
      container.style.display = "block";
      container.style.animation = "fadeIn 0.5s";

      setTimeout(() => {
        container.style.animation = "fadeOut 0.5s forwards";
        setTimeout(() => {
          container.style.display = "none";
          container.innerHTML = "";
        }, 500);
      }, duration * 1000);
    }
  </script>
</body>
</html>
